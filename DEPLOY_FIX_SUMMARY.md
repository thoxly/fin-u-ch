# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–µ–ø–ª–æ—è - –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞

**–î–∞—Ç–∞:** 2025-10-13  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ—à–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∞

Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ —á—Ç–æ:

- ‚úÖ –ù–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞–ª–∏—Å—å –∏ –ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏—Å—å –≤ GHCR
- ‚úÖ Workflow –∑–∞–≤–µ—Ä—à–∞–ª—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚úÖ Health check –ø—Ä–æ—Ö–æ–¥–∏–ª

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã:**

```
fin-u-ch-api    -> 9ed8ca91e21f (—Å—Ç–∞—Ä—ã–π)
fin-u-ch-web    -> 7528c2eefc4d (—Å—Ç–∞—Ä—ã–π)
fin-u-ch-worker -> 2504c4afe512 (—Å—Ç–∞—Ä—ã–π)

# –•–æ—Ç—è :latest —Ç–µ–≥–∏ —É–∫–∞–∑—ã–≤–∞–ª–∏ –Ω–∞ –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã:
ghcr.io/thoxly/fin-u-ch-api:latest    -> c9b22634e71d (–Ω–æ–≤—ã–π!)
ghcr.io/thoxly/fin-u-ch-web:latest    -> 1c0f662319ff (–Ω–æ–≤—ã–π!)
ghcr.io/thoxly/fin-u-ch-worker:latest -> 9a4c911d8e38 (–Ω–æ–≤—ã–π!)
```

## –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**SSH heredoc –≤ GitHub Actions –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥:**

```yaml
# ‚ùå –°–¢–ê–†–´–ô –ö–û–î (–ù–ï –†–ê–ë–û–¢–ê–õ):
ssh user@host << 'EOF'
docker compose pull ...
docker compose up -d ...
EOF
```

**–ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ:**

1. –ö–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤ –ø–æ–¥–æ–±–æ–ª–æ—á–∫–µ
2. STDOUT/STDERR –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –≤ GitHub Actions
3. SSH –≤–æ–∑–≤—Ä–∞—â–∞–ª –∫–æ–¥ 0, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–º–∞–Ω–¥—ã –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å
4. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±—ã–ª–æ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–æ–≥–æ–≤

## –†–µ—à–µ–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω–∏–µ deploy —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞ VPS —Å –ø—Ä—è–º—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:**

```yaml
# ‚úÖ –ù–û–í–´–ô –ö–û–î (–†–ê–ë–û–¢–ê–ï–¢):
# 1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
ssh user@host "cat > /opt/fin-u-ch/deploy.sh" << 'SCRIPT'
#!/bin/bash
set -e
echo "=== Deployment logs ==="
docker compose pull ...
docker compose up -d ...
SCRIPT

# 2. –°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
ssh user@host "chmod +x /opt/fin-u-ch/deploy.sh"

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
ssh user@host "GHCR_TOKEN='...' /opt/fin-u-ch/deploy.sh"
```

## –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ

### 1. `.github/workflows/ci-cd.yml`

–®–∞–≥ `Deploy to VPS` –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω:

**–ë—ã–ª–æ:**

- SSH heredoc –±–µ–∑ –≤—ã–≤–æ–¥–∞
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–ª–∞–¥–∏—Ç—å
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∏—Å—å

**–°—Ç–∞–ª–æ:**

- –°–æ–∑–¥–∞–Ω–∏–µ deploy.sh –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ü–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —à–∞–≥–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ –∏ –ø–æ—Å–ª–µ
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –æ—à–∏–±–æ–∫

### 2. `DEPLOY_ISSUE.md`

–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã:

- –°–∏–º–ø—Ç–æ–º—ã –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 3. `/opt/fin-u-ch/deploy.sh` (—Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–∞ VPS)

–ù–æ–≤—ã–π deploy —Å–∫—Ä–∏–ø—Ç —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º:

```bash
=== Starting deployment at [timestamp] ===
=== Current containers (before update) ===
=== Pulling new images ===
=== Available images ===
=== Applying database migrations ===
=== Stopping and removing old containers ===
=== Starting containers with new images ===
=== New containers (after update) ===
‚úÖ Deployment completed successfully!
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

‚úÖ **–í–∏–¥–∏–º–æ—Å—Ç—å:** –í–µ—Å—å –≤—ã–≤–æ–¥ Docker –∫–æ–º–∞–Ω–¥ –≤ –ª–æ–≥–∞—Ö GitHub Actions  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –û—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç workflow  
‚úÖ **–û—Ç–ª–∞–¥–∫–∞:** –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞  
‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ–º–æ—Å—Ç—å:** –í–∏–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ –∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è  
‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å:** –°–∫—Ä–∏–ø—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —Ä—É—á–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—à–µ–Ω–∏—è

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ ‚úÖ)

```bash
ssh root@83.166.244.139
cd /opt/fin-u-ch

# –í—ã–ø–æ–ª–Ω–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã –¥–µ–ø–ª–æ—è –≤—Ä—É—á–Ω—É—é
docker compose pull api web worker
docker compose stop api web worker
docker compose rm -f api web worker
docker compose up -d --force-recreate --pull always api web worker

# –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –£–°–ü–ï–®–ù–û –æ–±–Ω–æ–≤–∏–ª–∏—Å—å!
```

**–ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**

```
fin-u-ch-api    -> ghcr.io/thoxly/fin-u-ch-api:latest    ‚úÖ
fin-u-ch-web    -> ghcr.io/thoxly/fin-u-ch-web:latest    ‚úÖ
fin-u-ch-worker -> ghcr.io/thoxly/fin-u-ch-worker:latest ‚úÖ
```

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞
2. ‚úÖ –†–µ—à–µ–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
3. ‚è≥ Commit –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ `dev`
4. ‚è≥ –°–æ–∑–¥–∞—Ç—å PR –≤ `main`
5. ‚è≥ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
6. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ GitHub Actions

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –æ–±—Ä–∞–∑—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
ssh root@83.166.244.139 "docker ps --no-trunc --filter name=fin-u-ch --format '{{.Names}}: {{.Image}}'"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ :latest –æ–±—Ä–∞–∑—ã
ssh root@83.166.244.139 "docker images --no-trunc | grep 'fin-u-ch.*latest'"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
ssh root@83.166.244.139 "docker ps --filter name=fin-u-ch --format '{{.Names}}: created {{.RunningFor}}'"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–ø–ª–æ—è (–ø–æ—Å–ª–µ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è)
# GitHub Actions ‚Üí Actions ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π workflow ‚Üí Deploy to VPS job
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `.github/workflows/ci-cd.yml` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω Deploy to VPS step
2. `DEPLOY_ISSUE.md` - –æ–±–Ω–æ–≤–ª–µ–Ω —Å –ø–æ–ª–Ω—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –∏ —Ä–µ—à–µ–Ω–∏–µ–º
3. `DEPLOY_FIX_SUMMARY.md` - —Å–æ–∑–¥–∞–Ω–∞ –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

**–ì–æ—Ç–æ–≤–æ –∫ –∫–æ–º–º–∏—Ç—É –≤ `dev` –≤–µ—Ç–∫—É –∏ —Å–æ–∑–¥–∞–Ω–∏—é PR –≤ `main`** ‚úÖ
