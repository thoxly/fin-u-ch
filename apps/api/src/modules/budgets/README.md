# Budgets Management System

Система управления бюджетами для группировки планов и анализа выполнения. Бюджет связывает множество PlanItem через `budgetId` и позволяет анализировать выполнение планов по группам. Бюджеты имеют статусы (`active`, `archived`) и используются в отчете БДДС для отображения плановых данных по конкретному бюджету.

Бюджет представляет собой контейнер для группировки плановых операций (PlanItem) по логическим категориям. Например, можно создать бюджет "Маркетинг Q1 2024" и привязать к нему все планы на маркетинговые расходы в первом квартале. Бюджет имеет поля: `name` (название), `description` (описание), `companyId` (принадлежность к компании), `status` (active/archived), `createdAt`, `updatedAt`. Бюджеты не имеют собственных сумм или лимитов - они являются организационными единицами для группировки планов.

Создание и управление бюджетами выполняется через CRUD операции в `budgets.service.ts`. При создании бюджета указываются название и описание, бюджет автоматически получает статус `active`. Планы привязываются к бюджету через поле `budgetId` в PlanItem - это может быть сделано при создании плана или при обновлении существующего плана. Один план может быть привязан только к одному бюджету, но бюджет может содержать множество планов. Планы могут быть без бюджета (`budgetId: null`), что позволяет иметь несгруппированные планы.

Архивирование бюджета выполняется через обновление статуса на `archived`. При архивировании бюджета все связанные планы автоматически переходят в статус `archived` через каскадное обновление или явную логику в сервисе. Это позволяет скрывать устаревшие бюджеты и их планы из отчетов без удаления данных. Архивированные бюджеты и планы не участвуют в разворачивании и отчетах, но сохраняются в базе для истории.

В отчете БДДС при указании `budgetId` в параметрах запроса отображаются только планы из этого бюджета. Это позволяет анализировать выполнение конкретного бюджета отдельно от остальных планов. Планы разворачиваются в помесячные суммы через `expandPlan`, группируются по activity и type, и отображаются в структуре отчета. Если `budgetId` не указан, отображаются все активные планы компании. Это дает гибкость в анализе - можно посмотреть общий план-факт по всем планам или детализацию по конкретному бюджету.

**Ключевые файлы:** `budgets.service.ts` (CRUD операции: `createBudget`, `getBudget`, `updateBudget`, `deleteBudget`, `archiveBudget`), используется в `bdds.service.ts` (метод `getBDDS`) для фильтрации планов по `budgetId`. Для добавления функциональности бюджетам (например, лимиты, даты начала/окончания, автоматическое архивирование) расширьте схему БД (добавьте поля в модель `Budget`), обновите типы в TypeScript, и добавьте логику в сервис. Для каскадного архивирования планов при архивировании бюджета добавьте логику в метод `archiveBudget`.
