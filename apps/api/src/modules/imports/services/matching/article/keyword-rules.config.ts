import { KeywordRule } from '../matching.types';

/**
 * Предустановленные правила сопоставления статей по ключевым словам
 * TODO: В будущем вынести в БД или конфигурационный файл для возможности редактирования без деплоя
 */
export const KEYWORD_RULES: KeywordRule[] = [
  // Специфичные правила для зарплаты (проверяем раньше налогов, чтобы "Без налога" не перехватывало)
  {
    keywords: [
      'зарплата',
      'отпускные',
      'аванс',
      'премия',
      'заработная плата',
      'зарплата (аванс)',
      'зарплата за',
    ],
    articleNames: ['Зарплата', 'Выплаты персоналу', 'ФОТ'],
  },
  // Аренда (проверяем раньше выручки, чтобы "оплата счета за аренду" не попадала в выручку)
  {
    keywords: [
      'аренда',
      'за аренду',
      'аренда нежилых помещений',
      'нежилых помещений',
      'аренда помещений',
      'помещений',
      'аренда офиса',
      'аренда недвижимости',
      'оренда',
    ],
    articleNames: [
      'Аренда офиса',
      'Аренда помещений',
      'Оренда недвижимости',
      'Аренда',
    ],
  },
  // Выручка (проверяем раньше общих правил, но после более специфичных)
  {
    keywords: [
      'оплата по счету',
      'оплата счета',
      'счет №',
      'выручка',
      'поступление от клиента',
      'оплата покупателя',
      'доход',
      'продажа',
      'разработка по',
      'разработка программного обеспечения',
      'за разработку',
      'за разработку по',
      'услуги по разработке',
      'оказание услуг',
      'оказание услуг по',
    ],
    articleNames: [
      'Выручка от продаж',
      'Доход от реализации',
      'Поступления от клиентов',
      'Выручка',
    ],
  },
  // Налоги (общее правило, проверяем после специфичных)
  // ВАЖНО: Исключаем упоминания НДС в составе оплаты услуг/товаров
  {
    keywords: [
      'налог',
      'фнс',
      'пфр',
      'фсс',
      'ндс',
      'налоги',
      'пенсионный фонд',
    ],
    articleNames: ['Налоги', 'Обязательные платежи', 'Отчисления в фонды'],
  },
  {
    keywords: ['предоплата', 'аванс от клиента'],
    articleNames: ['Авансы от покупателей', 'Предоплата от клиентов'],
  },
  {
    keywords: [
      'поставщик',
      'счет на оплату',
      'закуп',
      'оплата поставщику',
      'покупка',
      'товар',
      'сырье',
    ],
    articleNames: [
      'Закупка товаров и материалов',
      'Оплата поставщикам',
      'Закуп сырья и комплектующих',
    ],
  },
  {
    keywords: ['услуги', 'работы', 'аутсорсинг', 'подрядчик'],
    articleNames: [
      'Оплата услуг и подрядчиков',
      'Услуги сторонних организаций',
      'Прочие услуги',
    ],
  },
  {
    keywords: ['транспорт', 'доставка', 'логистика', 'топливо'],
    articleNames: [
      'Транспортные расходы',
      'Доставка и логистика',
      'Топливо и ГСМ',
    ],
  },
  {
    keywords: ['интернет', 'телефон', 'связь', 'сотовая связь'],
    articleNames: ['Связь и интернет', 'Мобильная связь', 'Телефония'],
  },
  {
    keywords: ['канцелярия', 'бумага', 'принтер', 'картридж'],
    articleNames: [
      'Хозяйственные расходы',
      'Канцелярские товары',
      'Расходные материалы',
    ],
  },
  {
    keywords: ['банк', 'комиссия', 'эквайринг', 'обслуживание счета'],
    articleNames: [
      'Банковские комиссии',
      'Комиссии банка',
      'Расходы на обслуживание счета',
    ],
  },
  {
    keywords: ['проценты', 'кредит', 'займ', 'депозит'],
    articleNames: [
      'Финансовые расходы',
      'Проценты по кредитам',
      'Расходы по займам',
    ],
  },
  {
    keywords: ['страховка', 'страхование'],
    articleNames: ['Страхование', 'Добровольное страхование', 'ОСАГО / КАСКО'],
  },
  {
    keywords: ['командировка', 'проезд', 'гостиница'],
    articleNames: [
      'Командировочные расходы',
      'Проезд и проживание',
      'Транспорт и гостиницы',
    ],
  },
  {
    keywords: ['обучение', 'курсы', 'тренинг', 'повышение квалификации'],
    articleNames: [
      'Обучение и развитие персонала',
      'Повышение квалификации',
      'Расходы на обучение',
    ],
  },
  {
    keywords: ['реклама', 'маркетинг', 'продвижение', 'google ads', 'яндекс'],
    articleNames: ['Реклама и маркетинг', 'Продвижение', 'Интернет-реклама'],
  },
  {
    keywords: ['наличные', 'снятие', 'внесение'],
    articleNames: [
      'Операции с наличными',
      'Инкассация',
      'Снятие / внесение средств',
    ],
  },
  {
    keywords: ['дивиденды', 'выплата собственнику'],
    articleNames: [
      'Выплата дивидендов',
      'Распределение прибыли',
      'Выплаты учредителям',
    ],
  },
];

/**
 * Паттерны, которые указывают на НДС в составе оплаты, а не на налоговый платеж
 */
export const VAT_IN_PAYMENT_PATTERNS = [
  /в\s+том\s+числе\s+ндс/i, // "В том числе НДС"
  /в\s*т\.?\s*ч\.?\s*[^\w]*ндс/i, // "В т.ч. НДС", "В т.ч НДС", "В тч НДС", "В т.ч.НДС", "Вт.ч.НДС"
  /т\.?\s*ч\.?\s*[^\w]*ндс/i, // "т.ч. НДС", "т.ч НДС", "тч НДС", "т.ч.НДС"
  /включая\s+ндс/i, // "включая НДС"
  /ндс\s*\(?\s*\d+\s*%?\s*\)?/i, // "НДС 20%", "НДС(20%)", "НДС (20%)"
  /ндс\s*-\s*\d+/i, // "НДС - 2400.00"
  /ндс\s+\d+\.\d+/i, // "НДС 2400.00"
  /ндс\s+\d+-\d+/i, // "НДС 593103-20"
  /в\s+сумме\s+ндс/i, // "в сумме НДС"
  /с\s+ндс/i, // "с НДС"
  /оплат[аы]\s+.*\s+ндс/i, // "оплата ... НДС"
  /за\s+.*\s+ндс/i, // "за ... НДС"
  /по\s+счету.*ндс/i, // "по счету ... НДС"
  /реестр.*ндс/i, // "реестр ... НДС"
  /договор.*ндс/i, // "договор ... НДС"
  /ндс\s+не\s+облагается/i, // "НДС не облагается"
];

/**
 * Ключевые слова, указывающие на контекст оплаты услуг/товаров
 */
export const PAYMENT_CONTEXT_KEYWORDS = [
  'оплата за',
  'оплата по счету',
  'за товар',
  'за услуги',
  'за работы',
  'за поставку',
  'за доставку',
  'реестр на оплату',
  'реестр',
  'по договору',
  'договор',
  'счет',
  'сумма',
];

/**
 * Ключевые слова, указывающие на налоговый платеж
 */
export const TAX_PAYMENT_KEYWORDS = [
  'уплата ндс',
  'перечисление ндс',
  'налог ндс',
  'ндс к уплате',
  'ндс в бюджет',
  'возмещение ндс',
];
