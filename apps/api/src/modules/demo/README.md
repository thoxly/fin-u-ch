# Demo Data Generation System

Система автоматического создания демо-данных для тестирования и демонстрации функциональности. Генерирует полный набор тестовых данных: компанию, пользователей, справочники (статьи, счета, контрагенты), операции за последние 6 месяцев, планы и бюджеты. Используется для быстрого создания демо-аккаунтов и тестирования функциональности без ручного ввода данных.

Генерация начинается с создания компании через `demo.service.ts` с настройками по умолчанию (базовая валюта RUB, тариф START). Затем создается пользователь-владелец с email в формате `demo-{timestamp}@example.com` и паролем `demo123` для удобства тестирования. Пользователь помечается флагом `isDemo: true` для последующей автоматической очистки. Компания получает подписку START автоматически через стандартную логику регистрации.

Генерация справочников выполняется через `demo-catalogs.service.ts` и создает реалистичную структуру данных. Иерархия статей включает доходы (Продажи, Услуги, Прочие доходы) и расходы (Зарплата, Аренда, Маркетинг, Налоги и т.д.) с подстатьями для демонстрации иерархии. Счета создаются в разных валютах (RUB, USD, EUR) для демонстрации мультивалютности. Контрагенты создаются с реалистичными названиями и ИНН для демонстрации автосопоставления. Все справочники привязаны к созданной компании.

Генерация операций и планов выполняется через `demo-data-generator.service.ts` и создает данные за последние 6 месяцев. Операции генерируются с реалистичными суммами (в диапазонах, соответствующих типу операции), случайными датами в пределах периода, и случайным сопоставлением со статьями и контрагентами из созданных справочников. Операции включают income, expense и transfer типы для полноты демонстрации. Планы создаются с разными периодичностями (monthly, quarterly) для демонстрации БДДС и План-факт отчетов. Бюджеты создаются и привязываются к планам для демонстрации группировки.

Автоматическая очистка демо-данных выполняется через worker job `cleanup-demo-users.job.ts`, который запускается ежечасно. Job находит все компании с пользователями, помеченными `isDemo: true`, и проверяет время создания - если прошло более 24 часов, компания и все связанные данные удаляются каскадно. Это предотвращает накопление тестовых данных в базе и освобождает место. Очистка выполняется безопасно через транзакции Prisma с проверкой принадлежности данных к демо-компании.

**Ключевые файлы:** `demo.service.ts` (главный метод `createDemoData(companyName?, userEmail?)`), `demo-catalogs.service.ts` (методы генерации справочников: `generateArticles`, `generateAccounts`, `generateCounterparties`), `demo-data-generator.service.ts` (методы генерации данных: `generateOperations`, `generatePlans`, `generateBudgets`). Для изменения структуры демо-данных редактируйте соответствующие генераторы - можно изменить количество операций, период генерации, структуру статей и т.д. Worker job `cleanup-demo-users.job.ts` в `apps/worker/src/jobs/` удаляет старые демо-аккаунты. Для тестирования можно вызвать `createDemoData` вручную через API endpoint или скрипт.
