# Cashflow Table - Dark/Light Theme + Freeze

## Дата: 2025-10-16 (финальная версия)

## Выполненные изменения

### 1. Поддержка светлой и темной темы (Dark Mode)

#### Использование Tailwind CSS `dark:` модификатора

Все элементы теперь поддерживают обе темы через классы `dark:`:

**Светлая тема (по умолчанию):**

- Основной фон: `bg-white`
- Заголовки: `from-gray-100 to-gray-200`
- Текст: `text-gray-700`, `text-gray-900`
- Границы: `border-gray-200`

**Темная тема (при `dark` классе):**

- Основной фон: `dark:bg-gray-900`
- Заголовки: `dark:from-gray-800 dark:to-gray-900`
- Текст: `dark:text-gray-300`, `dark:text-gray-100`
- Границы: `dark:border-gray-700`

### 2. Адаптация цветов для темной темы

#### Цветовая схема

- **Основной фон**: `bg-gray-900` (почти черный)
- **Заголовки**: Градиент `from-gray-800 to-gray-900`
- **Шапка таблицы**: Градиент `from-gray-800 to-gray-900` с текстом `text-gray-100`
- **Границы**: `border-gray-700` вместо светлых границ
- **Тени**: Использование `rgba(0,0,0,0.5)` для темных теней

#### Строки данных

- **Потоки деятельности**:
  - Фон: `from-blue-900/40 to-blue-800/40` (полупрозрачный синий)
  - Текст: `text-blue-200`
  - Hover: `hover:from-blue-800/50 hover:to-blue-700/50`

- **Доходы**:
  - Фон: `bg-gray-800/50`
  - Текст: `text-green-400` (яркий зеленый для контраста)
  - Hover: `hover:bg-green-900/20`
  - Иконка: `text-green-400` ↑

- **Расходы**:
  - Фон: `bg-gray-800/50`
  - Текст: `text-red-400` (яркий красный для контраста)
  - Hover: `hover:bg-red-900/20`
  - Иконка: `text-red-400` ↓

#### Итоговые строки

- **Общий денежный поток**:
  - Градиент `from-gray-700 to-gray-800`
  - Текст: `text-gray-100`
- **Остаток на конец периода**:
  - Градиент `from-indigo-900/40 to-indigo-800/40`
  - Текст: `text-indigo-300`
  - Условная раскраска: `text-indigo-400` (положительный) / `text-red-400` (отрицательный)

### 3. Freeze (заморозка) строк и столбцов

#### Реализация "фриза" как в Excel

**Зафиксированная строка заголовков (thead):**

```jsx
<thead className="sticky top-0 z-30">
  {/* Заголовки остаются видны при вертикальном скролле */}
</thead>
```

**Зафиксированный столбец "Статья":**

```jsx
<th className="sticky left-0 z-40">Статья</th>
<td className="sticky left-0 z-10">Операционная деятельность</td>
```

**Скроллируемая область:**

- Контейнер: `overflow-auto max-h-[calc(100vh-280px)]`
- Скролл работает в обе стороны:
  - ↕ Вертикально (если много строк)
  - ↔ Горизонтально (по месяцам)

**Z-index иерархия для корректного наложения:**

- Заголовок "Статья": `z-40` (самый верхний)
- Строка заголовков: `z-30`
- Данные "Статья": `z-10`

### 4. Сокращение названий месяцев

- **До**: "октябрь 2024" (длинные названия)
- **После**: "окт 24" (короткий формат)
- **Реализация**:
  ```javascript
  new Date(month + '-01')
    .toLocaleDateString('ru-RU', {
      month: 'short',
      year: '2-digit',
    })
    .replace('.', '');
  ```
- **Размер шрифта**: `text-[10px]` для компактности
- **Преимущества**: Больше месяцев помещается на экране без скролла

### 5. Улучшенный скролл с ограничением по высоте

- **Контейнер**: `overflow-auto max-h-[calc(100vh-280px)]`
- **Двунаправленный скролл**:
  - ↕ Вертикальный - при большом количестве строк
  - ↔ Горизонтальный - по месяцам
- **Заголовки остаются видимыми** при вертикальном скролле (sticky top-0)
- **Колонка "Статья" остается видимой** при горизонтальном скролле (sticky left-0)

## Технические детали

### Структура Freeze (заморозка)

```jsx
<div className="overflow-auto max-h-[calc(100vh-280px)]">
  <table className="w-full border-collapse relative">
    {/* sticky top-0 - фриз строки заголовков */}
    <thead className="sticky top-0 z-30">
      <tr>
        {/* sticky left-0 - фриз колонки "Статья" */}
        <th className="sticky left-0 z-40">Статья</th>
        {/* Остальные колонки скроллятся */}
        <th>Окт 24</th>
        <th>Ноя 24</th>
        ...
      </tr>
    </thead>
    <tbody>
      <tr>
        {/* Каждая ячейка в первой колонке - sticky */}
        <td className="sticky left-0 z-10">Операционная</td>
        <td>1000₽</td>
        ...
      </tr>
    </tbody>
  </table>
</div>
```

### Dark Mode классы

```jsx
// Светлая + Темная тема
className = 'bg-white dark:bg-gray-900';
className = 'text-gray-700 dark:text-gray-300';
className = 'border-gray-200 dark:border-gray-700';

// Hover эффекты для обеих тем
className = 'hover:bg-green-50 dark:hover:bg-green-900/20';
```

### Hover эффекты в темной теме

Используются полупрозрачные overlay'и для плавных переходов:

- `hover:bg-green-900/20` - легкий зеленый оттенок при наведении на доходы
- `hover:bg-red-900/20` - легкий красный оттенок при наведении на расходы
- `hover:from-blue-800/50 hover:to-blue-700/50` - изменение градиента для потоков

## Преимущества новой реализации

### Визуальные

✅ Поддержка светлой И темной темы
✅ Высокий контраст в обеих темах
✅ Четкая цветовая кодировка (зеленый/красный)
✅ Профессиональный строгий вид
✅ Плавные переходы между темами

### Функциональные

✅ **Freeze колонки "Статья"** - остается видна при горизонтальном скролле →
✅ **Freeze строки с месяцами** - остается видна при вертикальном скролле ↓
✅ Компактные названия месяцев (окт 24)
✅ Двунаправленный скролл (↕↔)
✅ Ограничение высоты для больших таблиц

### UX

✅ Легко ориентироваться - заголовки всегда видны
✅ Легко найти нужную статью (зафиксирована слева)
✅ Удобный скролл по месяцам и строкам
✅ Плавные hover-эффекты
✅ Интуитивные иконки ↑/↓
✅ Работает как Excel freeze panes

## Тестирование

Проверьте следующие сценарии:

### Freeze (заморозка)

1. ✅ При горизонтальном скролле → колонка "Статья" остается на месте
2. ✅ При вертикальном скролле ↓ строка с месяцами остается на месте
3. ✅ Диагональный скролл ↘ работает корректно

### Темы

4. ✅ Светлая тема - все элементы видны и контрастны
5. ✅ Темная тема - все элементы видны и контрастны
6. ✅ Переключение между темами работает плавно

### Функциональность

7. ✅ Названия месяцев компактные и читаемые
8. ✅ Hover эффекты работают в обеих темах
9. ✅ Раскрытие/сворачивание потоков работает
10. ✅ Колонка "Итого" скроллится вместе с данными
11. ✅ Иконки ↑/↓ для доходов/расходов видны

## Совместимость

- ✅ Tailwind CSS `dark:` модификатор
- ✅ Sticky positioning (CSS)
- ✅ Полная типизация TypeScript
- ✅ Responsive дизайн
- ✅ Совместимость с существующим API
- ✅ Браузеры: Chrome, Firefox, Safari, Edge (все современные версии)

## Как включить темную тему

Добавьте класс `dark` на родительский элемент или `<html>`:

```html
<html class="dark">
  <!-- Вся таблица автоматически переключится на темную тему -->
</html>
```
