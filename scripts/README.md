# üîß Scripts Directory

–ö–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ª–µ–∑–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–æ–º Fin-U-CH.

---

## üì¶ Backup Scripts

### üóÑÔ∏è `backup-db.sh`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
./scripts/backup-db.sh

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ (cron)
0 3 * * * /opt/fin-u-ch/scripts/backup-db.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:

- –°–æ–∑–¥–∞—ë—Ç –¥–∞–º–ø PostgreSQL
- –°–∂–∏–º–∞–µ—Ç —Ñ–∞–π–ª (gzip)
- –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (> 30 –¥–Ω–µ–π)
- –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

- Docker Compose –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤**: `/opt/fin-u-ch/backups/`

---

### üîô `restore-db.sh`

–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±—ç–∫–∞–ø–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
./scripts/restore-db.sh backups/backup-20240108-030001.sql.gz

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞
./scripts/restore-db.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:

- –°–æ–∑–¥–∞—ë—Ç safety backup —Ç–µ–∫—É—â–µ–π –ë–î
- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç API –∏ Worker
- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ë–î –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–∏—Å—ã –æ–±—Ä–∞—Ç–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç health endpoint

**‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï**: –û–ø–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö!

---

### ü©∫ `check-backups.sh`

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã –±—ç–∫–∞–ø–æ–≤.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```bash
./scripts/check-backups.sh
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**:

- –ù–∞–ª–∏—á–∏–µ –±—ç–∫–∞–ø–æ–≤
- –í–æ–∑—Ä–∞—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±—ç–∫–∞–ø–∞ (–Ω–µ —Å—Ç–∞—Ä—à–µ 30 —á–∞—Å–æ–≤)
- –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤ (–Ω–µ –º–µ–Ω—å—à–µ 100KB)
- –û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö

**Exit codes**:

- `0` - –í—Å—ë OK
- `1` - –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

**–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ**:

```bash
# –í cron
0 */12 * * * /opt/fin-u-ch/scripts/check-backups.sh || echo "ALERT: Backup health check failed!"
```

---

### ‚öôÔ∏è `setup-backups.sh`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±—ç–∫–∞–ø–æ–≤ –Ω–∞ VPS.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** (–Ω–∞ VPS):

```bash
sudo ./scripts/setup-backups.sh
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:

1. –°–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `/opt/fin-u-ch/backups/`
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã (`chmod +x`)
3. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –±—ç–∫–∞–ø

**Cron –∑–∞–¥–∞—á–∏**:

- –ë—ç–∫–∞–ø –ë–î: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 3:00 AM
- Health check: –∫–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**:

- –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ VPS
- –ü—Ä–∞–≤–∞ root –∏–ª–∏ sudo

---

## ü§ñ AI Review Scripts

### `ai-review/`

–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å AI Code Review –∞–≥–µ–Ω—Ç–æ–º –¥–ª—è GitHub Actions.

–°–º. [ai-review/README.md](./ai-review/README.md) –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã**:

- `src/index.ts` - –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
- `src/claude-reviewer.ts` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude API
- `src/github-client.ts` - —Ä–∞–±–æ—Ç–∞ —Å GitHub API
- `src/context-loader.ts` - –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞

---

## üìã –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ù–∞ VPS

```bash
# –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±—ç–∫–∞–ø–æ–≤ (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
sudo /opt/fin-u-ch/scripts/setup-backups.sh

# –†—É—á–Ω–æ–π –±—ç–∫–∞–ø
/opt/fin-u-ch/scripts/backup-db.sh

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ –±—ç–∫–∞–ø–æ–≤
/opt/fin-u-ch/scripts/check-backups.sh

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –±—ç–∫–∞–ø
/opt/fin-u-ch/scripts/restore-db.sh

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –±—ç–∫–∞–ø—ã
ls -lht /opt/fin-u-ch/backups/

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥ –±—ç–∫–∞–ø–æ–≤
tail -50 /opt/fin-u-ch/backups/backup.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron –∑–∞–¥–∞—á–∏
crontab -l
```

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# AI Review —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ GitHub Actions
# –ù–æ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
cd scripts/ai-review
pnpm install
pnpm build
pnpm start
```

---

## üõ°Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±—ç–∫–∞–ø–∞–º

### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

- **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø–æ–ª–Ω—ã–µ –±—ç–∫–∞–ø—ã**: 3:00 AM (–Ω–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)
- **Health checks**: –ö–∞–∂–¥—ã–µ 12 —á–∞—Å–æ–≤
- **–†—É—á–Ω–æ–π –±—ç–∫–∞–ø**: –ü–µ—Ä–µ–¥ –≤–∞–∂–Ω—ã–º–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

### Retention Policy

- **–õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ VPS**: 30 –¥–Ω–µ–π
- **–í–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è): 90+ –¥–Ω–µ–π
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã**: –ë–µ—Å—Å—Ä–æ—á–Ω–æ

### Off-site Backup (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±—ç–∫–∞–ø–æ–≤ –≤–æ –≤–Ω–µ—à–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:

```bash
# –ü—Ä–∏–º–µ—Ä: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ S3
aws s3 sync /opt/fin-u-ch/backups/ s3://my-backups/fin-u-ch/ --exclude "*.log"

# –ü—Ä–∏–º–µ—Ä: –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ rsync –Ω–∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–µ—Ä
rsync -avz /opt/fin-u-ch/backups/ user@backup-server:/backups/fin-u-ch/

# –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ cron –ø–æ—Å–ª–µ backup-db.sh
```

---

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: backup-db.sh fails

**–†–µ—à–µ–Ω–∏–µ**:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker compose ps postgres`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs postgres`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é: `ls -la /opt/fin-u-ch/backups/`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ: `df -h`

### –ü—Ä–æ–±–ª–µ–º–∞: restore-db.sh fails

**–†–µ—à–µ–Ω–∏–µ**:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –±—ç–∫–∞–ø —Ñ–∞–π–ª –Ω–µ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω: `gunzip -t backup.sql.gz`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ safety backup —Å–æ–∑–¥–∞–Ω
3. –û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∫ safety backup –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL

### –ü—Ä–æ–±–ª–µ–º–∞: Cron –∑–∞–¥–∞—á–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ**:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron —Å–µ—Ä–≤–∏—Å: `sudo systemctl status cron`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–¥–∞—á–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã: `crontab -l`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Å–∫—Ä–∏–ø—Ç—ã: `ls -l /opt/fin-u-ch/scripts/`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron –ª–æ–≥–∏: `grep CRON /var/log/syslog`

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Backup Strategy](../docs/BACKUP_STRATEGY.md) - –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –±—ç–∫–∞–ø–æ–≤ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- [CI/CD Pipeline](../docs/CI_CD.md) - CI/CD –ø—Ä–æ—Ü–µ—Å—Å
- [Dev Guide](../docs/DEV_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2024-01-08
