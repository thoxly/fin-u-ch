# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ WORKER_API_KEY

## –û–ø–∏—Å–∞–Ω–∏–µ

`WORKER_API_KEY` ‚Äî —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ worker'–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ API. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç worker'—É –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –æ—Ç –∏–º–µ–Ω–∏ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

- **API** (`apps/api/src/config/env.ts`): –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `WORKER_API_KEY` –≤ middleware –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **Worker** (`apps/worker/src/config/env.ts`): –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–ª—é—á –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
- **Ozon Integration**: Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π Ozon

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: Node.js (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: PowerShell (Windows)

```powershell
[Convert]::ToHexString((1..32 | ForEach-Object { Get-Random -Minimum 0 -Maximum 256 }))
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: OpenSSL (Linux/Mac)

```bash
openssl rand -hex 32
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç)

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ fin-u-ch/
touch .env
```

### 2. –î–æ–±–∞–≤—å—Ç–µ WORKER_API_KEY –≤ `.env`

```env
WORKER_API_KEY=–≤–∞—à_—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π_64_—Å–∏–º–≤–æ–ª—å–Ω—ã–π_hex_–∫–ª—é—á_–∑–¥–µ—Å—å
```

**–ü—Ä–∏–º–µ—Ä:**

```env
WORKER_API_KEY=a1b2c3d4e5f6789012345678901234567890abcdef1234567890abcdef123456
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ API –∏ Worker

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (Ctrl+C)
# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:

# Terminal 1: API
cd apps/api
pnpm dev

# Terminal 2: Worker
cd apps/worker
pnpm dev
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ worker –¥–æ–ª–∂–µ–Ω:

1. ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å health check –∫ API
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API —Ä–µ–∂–∏–º –≤–º–µ—Å—Ç–æ direct mode
3. ‚úÖ –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ `WORKER_API_KEY`

**–õ–æ–≥–∏ worker'–∞ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:**

```
‚úÖ API –¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º API —Ä–µ–∂–∏–º
```

–í–º–µ—Å—Ç–æ:

```
‚ö†Ô∏è  API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –ø—Ä—è–º–æ–π —Ä–µ–∂–∏–º (direct)
üí° –î–ª—è —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ API –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ WORKER_API_KEY –≤ .env —Ñ–∞–π–ª–µ
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚ö†Ô∏è **–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ** `.env` —Ñ–∞–π–ª –≤ git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π (dev, staging, production)
- ‚úÖ –•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á –≤ —Å–µ–∫—Ä–µ—Ç–∞—Ö CI/CD (GitHub Secrets, GitLab CI Variables –∏ —Ç.–¥.)
- ‚úÖ –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–º (–º–∏–Ω–∏–º—É–º 32 –±–∞–π—Ç–∞ = 64 hex —Å–∏–º–≤–æ–ª–∞)

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ WORKER_API_KEY?

–ï—Å–ª–∏ `WORKER_API_KEY` –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω:

- Worker –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **direct mode** (–ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î –∏ Ozon API)
- Health check –∫ API –±—É–¥–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Prisma –∏ Ozon API
- –≠—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ API —Ä–µ–∂–∏–º –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## Troubleshooting

### Worker –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `WORKER_API_KEY` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `API_URL` –≤ worker'–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env`

### –û—à–∏–±–∫–∞ 401 –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –æ—Ç worker'–∞

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `WORKER_API_KEY` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ `.env` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±–æ–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤, –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫)
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API —Å–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∑–∏–ª –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `.env` —Ñ–∞–π–ª
