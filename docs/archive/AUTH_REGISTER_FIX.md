# Исправление ошибки 500 при регистрации

## Проблема

При регистрации пользователя через POST `/api/auth/register` периодически возникала ошибка 500.

## Причины

1. **Неправильный тип транзакции Prisma**: В `seed-initial-data.ts` использовался тип `PrismaClient` вместо правильного типа транзакции
2. **Недостаточная обработка ошибок**: Не обрабатывались специфичные ошибки Prisma (например, P2002 - unique constraint violation)
3. **Race conditions**: При одновременной регистрации двух пользователей с одинаковым email могла возникнуть ошибка

## Изменения

### 1. `apps/api/src/modules/auth/seed-initial-data.ts`

- ✅ Добавлен правильный тип для транзакции `TransactionClient`
- ✅ Добавлено детальное логирование каждого этапа создания начальных данных
- ✅ Добавлена обработка ошибок с полными деталями

### 2. `apps/api/src/modules/auth/auth.service.ts`

- ✅ Исправлен тип транзакции с `any` на `TransactionClient`
- ✅ Добавлена обработка ошибок Prisma (P2002 - unique constraint)
- ✅ Улучшено логирование ошибок с деталями стека и кодами ошибок
- ✅ Добавлен try-catch для транзакции регистрации

## Результат

- ✅ Правильная типизация транзакций
- ✅ Детальное логирование для отладки
- ✅ Обработка race conditions
- ✅ Понятные сообщения об ошибках для пользователя

## Тестирование

После этих изменений:

1. Ошибка 500 при регистрации больше не должна возникать
2. Все ошибки логируются с полными деталями
3. При race conditions возвращается 409 вместо 500
4. Ошибки seedInitialData логируются с указанием конкретного этапа
