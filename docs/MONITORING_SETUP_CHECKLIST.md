# –ß–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ Production

–≠—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ.

## ‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- [ ] –î–æ—Å—Ç—É–ø –∫ production —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
- [ ] Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –§–∞–π–ª `.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏

## üìã –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Telegram –±–æ—Ç–∞

- [ ] –°–æ–∑–¥–∞–Ω –±–æ—Ç —á–µ—Ä–µ–∑ @BotFather –≤ Telegram
- [ ] –ü–æ–ª—É—á–µ–Ω `TELEGRAM_BOT_TOKEN` –æ—Ç @BotFather
- [ ] –ü–æ–ª—É—á–µ–Ω `TELEGRAM_CHAT_ID` (—á–µ—Ä–µ–∑ @userinfobot –∏–ª–∏ API)
- [ ] –ë–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –≥—Ä—É–ø–ø–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è)

## üìã –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª:

```bash
ssh your-user@your-server
cd /opt/fin-u-ch
nano .env  # –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à –ª—é–±–∏–º—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
```

–î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# Telegram –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_CHAT_ID=123456789

# Grafana (–∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å!)
GRAFANA_ADMIN_PASSWORD=your-secure-password

# Retention –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
PROMETHEUS_RETENTION=15d
LOKI_RETENTION=720h
```

- [ ] `TELEGRAM_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] `TELEGRAM_CHAT_ID` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] `GRAFANA_ADMIN_PASSWORD` –∏–∑–º–µ–Ω–µ–Ω —Å –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è

## üìã –®–∞–≥ 3: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ GitHub Actions. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/fin-u-ch
mkdir -p monitoring/{alertmanager,prometheus,grafana,loki,promtail,tempo}

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ scp
```

- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- [ ] –ü—É—Ç–∏ –≤ `docker-compose.prod.yml` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## üìã –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ —á–µ—Ä–µ–∑ GitHub Actions.

- [ ] –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–ø–ª–æ—è –∏–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é (—Å–º. –í–∞—Ä–∏–∞–Ω—Ç B)

### –í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
cd /opt/fin-u-ch
docker compose -f docker-compose.prod.yml up -d \
  uptime-kuma \
  prometheus \
  alertmanager \
  grafana \
  loki \
  promtail \
  tempo \
  node-exporter \
  cadvisor \
  postgres-exporter \
  redis-exporter
```

- [ ] –í—Å–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å: `docker compose -f docker-compose.prod.yml ps`

## üìã –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
cd /opt/fin-u-ch
chmod +x ops/scripts/test-monitoring.sh
./ops/scripts/test-monitoring.sh
```

–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é:

- [ ] Uptime Kuma –¥–æ—Å—Ç—É–ø–µ–Ω: `http://your-domain:3001`
- [ ] Prometheus –¥–æ—Å—Ç—É–ø–µ–Ω: `http://your-domain:9090`
- [ ] Alertmanager –¥–æ—Å—Ç—É–ø–µ–Ω: `http://your-domain:9093`
- [ ] Grafana –¥–æ—Å—Ç—É–ø–µ–Ω: `http://your-domain:3000`
- [ ] Loki –¥–æ—Å—Ç—É–ø–µ–Ω: `http://your-domain:3100`

## üìã –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Uptime Kuma

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://your-domain:3001` –≤ –±—Ä–∞—É–∑–µ—Ä–µ

2. **–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
   - [ ] –í–≤–µ–¥–µ–Ω username –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - [ ] –í–≤–µ–¥–µ–Ω –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
   - [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:**
   - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –≤ **Settings** ‚Üí **Notifications**
   - [ ] –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ **"Add Notification"**
   - [ ] –í—ã–±—Ä–∞–Ω —Ç–∏–ø **"Telegram"**
   - [ ] –í—Å—Ç–∞–≤–ª–µ–Ω `TELEGRAM_BOT_TOKEN` –∏–∑ `.env`
   - [ ] –í—Å—Ç–∞–≤–ª–µ–Ω `TELEGRAM_CHAT_ID` –∏–∑ `.env`
   - [ ] –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ **"Test"** - –ø–æ–ª—É—á–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
   - [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã

4. **–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–æ–≤:**
   - [ ] –°–æ–∑–¥–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä –¥–ª—è Frontend (`https://your-domain/`)
   - [ ] –°–æ–∑–¥–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä –¥–ª—è API Health (`https://your-domain/api/health`)
   - [ ] –°–æ–∑–¥–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä –¥–ª—è Nginx Health (`https://your-domain/health`)
   - [ ] –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∞ –≤–∫–ª—é—á–µ–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üìã –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∫–∞ Alertmanager

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Alertmanager –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```bash
docker exec fin-u-ch-alertmanager cat /etc/alertmanager/alertmanager.yml
```

- [ ] –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ—Ç `${TELEGRAM_BOT_TOKEN}` (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã)
- [ ] –í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ—Ç `${TELEGRAM_CHAT_ID}` (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã)
- [ ] Alertmanager –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è `.env` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

## üìã –®–∞–≥ 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://your-domain:3000` –≤ –±—Ä–∞—É–∑–µ—Ä–µ

2. **–í—Ö–æ–¥:**
   - [ ] –í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω (admin / –≤–∞—à –ø–∞—Ä–æ–ª—å –∏–∑ `GRAFANA_ADMIN_PASSWORD`)

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ datasources:**
   - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –≤ **Configuration** ‚Üí **Data Sources**
   - [ ] Prometheus datasource –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] Loki datasource –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - [ ] Tempo datasource –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ dashboards:**
   - [ ] –ü–µ—Ä–µ—Ö–æ–¥ –≤ **Dashboards**
   - [ ] Dashboards –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
   - [ ] Dashboards –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –¥–∞–Ω–Ω—ã–µ

## üìã –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω—ã–º —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω (–Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ IP:–ø–æ—Ä—Ç):

- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã upstream –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ nginx.conf
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã location –±–ª–æ–∫–∏ –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSL –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ–º–µ–Ω–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] Nginx –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω: `docker restart fin-u-ch-nginx`

## üìã –®–∞–≥ 10: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–ø—É—â–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Uptime Kuma –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
- [ ] Alertmanager –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram (–º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ Prometheus)
- [ ] Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏
- [ ] Grafana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç dashboards
- [ ] Loki —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏
- [ ] –í—Å–µ health checks –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

## üîß Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker compose -f docker-compose.prod.yml logs uptime-kuma
docker compose -f docker-compose.prod.yml logs prometheus
docker compose -f docker-compose.prod.yml logs alertmanager

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker compose -f docker-compose.prod.yml ps
```

### –ü—Ä–æ–±–ª–µ–º–∞: Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω
3. –î–ª—è –ª–∏—á–Ω–æ–≥–æ —á–∞—Ç–∞: –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –±–æ—Ç—É `/start`
4. –î–ª—è –≥—Ä—É–ø–ø—ã: —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∏ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Alertmanager: `docker logs fin-u-ch-alertmanager`

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã
ls -la /opt/fin-u-ch/monitoring/

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –≤ docker-compose.prod.yml
grep -A 2 "volumes:" docker-compose.prod.yml | grep monitoring
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É](./MONITORING.md)
- [Uptime Kuma Documentation](https://github.com/louislam/uptime-kuma)
- [Prometheus Documentation](https://prometheus.io/docs/)
- [Grafana Documentation](https://grafana.com/docs/)
