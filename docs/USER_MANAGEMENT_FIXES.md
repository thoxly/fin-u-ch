# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

–î–∞—Ç–∞: 21 –Ω–æ—è–±—Ä—è 2024

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. ‚úÖ –ó–∞—â–∏—Ç–∞ –°–∏—Å—Ç–µ–º–Ω—ã—Ö –†–æ–ª–µ–π –æ—Ç –£–¥–∞–ª–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å**: –£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–°–∏—Å—Ç–µ–º–Ω–∞—è —Ä–æ–ª—å**: –¢–æ–ª—å–∫–æ —Ä–æ–ª—å "–°—É–ø–µ—Ä-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å" —è–≤–ª—è–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω–æ–π (`isSystem: true`). –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏ ("–ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø" –∏ "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π") –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å.

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è**:

- **Backend** (`apps/api/src/modules/users/users.service.ts`, —Å—Ç—Ä–æ–∫–∏ 917-925):
  - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ä–æ–ª—å —Å–∏—Å—Ç–µ–º–Ω–æ–π (`role.isSystem`)
  - –ë–ª–æ–∫–∏—Ä—É–µ—Ç —Å–Ω—è—Ç–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π —Å –æ—à–∏–±–∫–æ–π 403 "Cannot remove system role"
- **Frontend** (`apps/web/src/pages/admin/UsersPage.tsx`, —Å—Ç—Ä–æ–∫–∏ 658-672):
  - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ—Ç–∫—É "(–°–∏—Å—Ç–µ–º–Ω–∞—è)" –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π
  - –°–∫—Ä—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–Ω—è—Ç—å" –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π (`!userRole.role.isSystem`)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
–ö–æ–≥–¥–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–æ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å –º–µ—Ç–∫–æ–π "(–°–∏—Å—Ç–µ–º–Ω–∞—è)" –∏ –±–µ–∑ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è. –ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ–±–æ–π—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é, –±—ç–∫–µ–Ω–¥ –∑–∞–±–ª–æ–∫–∏—Ä—É–µ—Ç —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ.

---

### 2. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –û–¥–Ω—É –†–æ–ª—å

**–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

- –ó–∞–º–µ–Ω—ë–Ω multi-select –Ω–∞ single-select –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
- –ò–∑–º–µ–Ω–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: `inviteRoleIds` ‚Üí `inviteRoleId`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø—Ü–∏—è "–ë–µ–∑ —Ä–æ–ª–∏" –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ä–æ–ª—å –Ω–µ –Ω—É–∂–Ω–∞

**–§–∞–π–ª—ã**:

- `apps/web/src/pages/admin/UsersPage.tsx`

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:
–ü—Ä–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É —Ä–æ–ª—å –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞.

---

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω 404 –ø—Ä–∏ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°—Ç–∞—Ç—É—Å**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞**:
–ú–∞—Ä—à—Ä—É—Ç—ã `/me/change-password` –∏ –¥—Ä—É–≥–∏–µ `/me/*` –º–∞—Ä—à—Ä—É—Ç—ã –±—ã–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ü–û–°–õ–ï –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ `/:id`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º –≤ Express.js.

**–†–µ—à–µ–Ω–∏–µ**:
–ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –º–∞—Ä—à—Ä—É—Ç—ã –≤ `apps/api/src/modules/users/users.routes.ts`:

```typescript
// –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫:
1. /me (GET)
2. /me (PATCH)
3. /me/change-password (POST)
4. /me/request-email-change (POST)
5. /me/confirm-email-change-old (POST)
6. /me/confirm-email-change (POST)
7. / (GET)
8. /invite (POST)
9. /:id (PATCH) - —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç /me/* –º–∞—Ä—à—Ä—É—Ç—ã
10. /:id (DELETE)
11. /:id/roles (GET)
12. /:id/roles (POST)
13. /:id/roles/:roleId (DELETE)
14. /:id/permissions (GET)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:
–¢–µ–ø–µ—Ä—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –î–µ–π—Å—Ç–≤–∏—è ‚Üí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –±–µ–∑ –æ—à–∏–±–∫–∏ 404.

---

### 4. üìß –°—Ç–∞—Ç—É—Å Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏

**–°—Ç–∞—Ç—É—Å**: –ù–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û (–ø–æ –¥–∏–∑–∞–π–Ω—É)

**–¢–µ–∫—É—â–µ–µ –ü–æ–≤–µ–¥–µ–Ω–∏–µ**:
–ü—Ä–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
3. –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –û–î–ò–ù –†–ê–ó
4. **Email –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**

**–ö–æ–¥**:
–í `apps/api/src/modules/users/users.service.ts` (—Å—Ç—Ä–æ–∫–∞ 450) –µ—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:

```typescript
// TODO: –û—Ç–ø—Ä–∞–≤–∏—Ç—å email —Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ–º
```

**–¢–µ–∫—É—â–∏–π –ü—Ä–æ—Ü–µ—Å—Å**:

1. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –∏ –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º –∏ –º–µ–Ω—è–µ—Ç –µ–≥–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**:
–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å–µ–º
2. –°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –ø–∏—Å—å–º–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ `mail.service.ts`
4. –í—ã–∑–≤–∞—Ç—å —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –≤ `inviteUser` –º–µ—Ç–æ–¥–µ

---

## –ò—Ç–æ–≥–æ–≤—ã–µ –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –§–∞–π–ª—ã:

1. `apps/api/src/modules/users/users.routes.ts` - –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –º–∞—Ä—à—Ä—É—Ç—ã
2. `apps/web/src/pages/admin/UsersPage.tsx` - –ò–∑–º–µ–Ω—ë–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω—É —Ä–æ–ª—å

### –¢—Ä–µ–±—É–µ—Ç—Å—è –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫:

- ‚úÖ API —Å–µ—Ä–≤–µ—Ä (–∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö)
- ‚úÖ Web –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ UI)

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ü—Ä–æ–≤–µ—Ä–∫–∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

1. **–°–∏—Å—Ç–µ–º–Ω—ã–µ –†–æ–ª–∏**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —â–∏—Ç–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ä–æ–ª—å—é
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ "–°–Ω—è—Ç—å" –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–æ–ª–µ–π

2. **–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Å –û–¥–Ω–æ–π –†–æ–ª—å—é**:
   - –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–æ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ (–æ–¥–Ω–∞ —Ä–æ–ª—å)
   - –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

3. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏"
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É –∫–∞—Ä–∞–Ω–¥–∞—à–∞ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ò–∑–º–µ–Ω–∏—Ç–µ –∏–º—è/—Ñ–∞–º–∏–ª–∏—é
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—à–∏–±–∫–∞ 404 –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

4. **Email –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è**:
   - –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å –≤—Ä—É—á–Ω—É—é –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ó–∞–º–µ—Ç–∫–∏

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ lint –æ—à–∏–±–æ–∫
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ù–∏–∫–∞–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π –ë–î –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
