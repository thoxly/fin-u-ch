# Настройка шифрования API ключей

## Описание

API ключи интеграций Ozon теперь шифруются в базе данных с использованием AES-256-GCM.

## Настройка

### 1. Генерация ключа шифрования

Для генерации безопасного ключа шифрования (32 байта в hex формате):

```bash
# Linux/Mac
openssl rand -hex 32

# Windows PowerShell
[Convert]::ToHexString((1..32 | ForEach-Object { Get-Random -Minimum 0 -Maximum 256 }))
```

Или используйте Node.js:

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

### 2. Добавление ключа в переменные окружения

Добавьте в файл `.env` в корне проекта:

```env
ENCRYPTION_KEY=ваш_64_символьный_hex_ключ_здесь
```

**Важно:**

- Ключ должен быть 64 символа (32 байта в hex формате)
- Или может быть произвольной строкой (будет использован scrypt для генерации ключа)
- НЕ коммитьте `.env` файл в git
- Используйте разные ключи для разных окружений (dev, staging, production)

### 3. Миграция существующих данных

Если у вас уже есть незашифрованные API ключи в базе данных, они будут автоматически зашифрованы при следующем сохранении интеграции.

Для обратной совместимости:

- Старые незашифрованные ключи будут автоматически расшифровываться (возвращаются как есть)
- При следующем сохранении интеграции они будут зашифрованы

## Безопасность

- API ключи шифруются перед сохранением в БД
- API ключи НЕ возвращаются в ответах API (маскируются как `***`)
- Используется AES-256-GCM с уникальными IV и солью для каждого шифрования
- Ключ шифрования хранится только в переменных окружения

## Проверка

После настройки проверьте:

1. Сохранение новой интеграции - ключ должен быть зашифрован в БД
2. Использование интеграции - ключ должен автоматически расшифровываться
3. Ответы API - ключ должен быть замаскирован как `***`
