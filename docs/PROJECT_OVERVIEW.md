# PROJECT_OVERVIEW (English)

Goal: Simple cash management for small teams with plan vs fact analysis, operations, and basic reports. Multi-tenant via companies.

## Цель

Простый финучёт для малых команд с план-факт анализом (БДДС) и базовыми отчётами (ОДДС), операциями и дашбордом.

## Модель доступа

Multi-tenant (Компания → Пользователи с одинаковыми правами в MVP).

## Ключевые возможности v1

### Дашборд

- Доходы/расходы/чистая прибыль + остатки на счетах
- Фильтры период/план/факт
- Временные ряды по месяцам
- Кэширование отчетов (Redis)

### Операции

- Поступление/списание/перевод
- Контрагент
- Статья
- Сделка
- Периодичность (рекуррентные)
- Автоматическая генерация зарплатных операций

### Планирование БДДС

- **Управление бюджетами**: Создание и группировка плановых записей по бюджетам
- **Таблица по месяцам**: Продвинутый компонент PlanMatrixTable с группировкой по видам деятельности
- **Деталь по статьям**: Иерархическое отображение доходов и расходов
- **Плановые операции**: Повторяемые операции с поддержкой различных периодов
- **Статусы планов**: Активный/приостановлен/архив для плановых записей
- **Статусы бюджетов**: Активный/архив для бюджетов

### Отчёты

#### ОДДС (Операционный денежный поток)

- По видам деятельности: операционная/инвестиционная/финансовая
- Помесячно
- Округление сумм

#### БДДС (Бюджет движения денежных средств)

- Плановые операции по статьям
- Развертывание повторяющихся планов

#### DDS (Детальный денежный поток)

- Детализация по статьям
- Остатки по счетам
- Пагинация для больших объемов

#### План-факт анализ

- Сравнение планов и фактов
- Анализ по статьям/подразделениям/сделкам
- Отклонения в абсолютных и относительных величинах

### Справочники

- Статьи (с иерархией)
- Счета
- Подразделения
- Контрагенты
- Сделки
- Зарплаты (с автоматической генерацией)

### Демо-система

- Автоматическое создание демо-пользователя при первом запуске сервера
- Генерация тестовых данных (операции, планы, зарплаты)
- Полная настройка справочников
- Публичный endpoint для получения учетных данных
- Удаление демо-данных

### UI и Персонализация

- Темная/светлая тема ✅
- Настройка иконок навигации ✅
- Сохранение пользовательских предпочтений ✅
- Адаптивный дизайн ✅
- OffCanvas компонент для форм справочников ✅
- Уведомления (notifications system) ⚠️ (структура есть, функционал не реализован)
- Landing page с описанием возможностей ✅

## Нефункциональные требования

### Масштабирование

- До 1000 пользователей (тенантов) суммарно
- Монорепо

### Технологический стек

| Категория            | Технология                                   |
| -------------------- | -------------------------------------------- |
| **Frontend**         | React18 + TypeScript + Vite + Tailwind       |
| **State Management** | Redux Toolkit + RTK Query                    |
| **Backend**          | Node18 + Express + TypeScript                |
| **Worker**           | Node18 + TypeScript + node-cron              |
| **ORM**              | Prisma                                       |
| **База данных**      | PostgreSQL (multi-tenant)                    |
| **Cache**            | Redis (ioredis)                              |
| **Reverse Proxy**    | Nginx                                        |
| **Аутентификация**   | JWT + bcryptjs                               |
| **API Docs**         | OpenAPI (swagger-jsdoc + swagger-ui-express) |
| **Testing**          | Jest (unit/integration) + Playwright (E2E)   |
| **Монорепо**         | pnpm workspaces                              |
| **CI/CD**            | GitHub Actions + Docker + VPS                |
| **Версионирование**  | Semantic Versioning (SemVer)                 |

### CI/CD (MVP)

#### Репозиторий

- GitHub (git-flow: feature / dev / main)

#### Проверки в PR

- ESLint + Prettier + минимальные unit-тесты

#### Автоматический деплой

## UI Flow

### Рабочий стол

- **Фильтры**: период, переключатель план/факт/оба.
- **Блоки**:
  - (1) Доходы/Расходы/Чистая прибыль (график, суммарные KPI)
  - (2) Остатки на счетах (таблица/бар)
- **Таблица «Доходы-Расходы»** — переключатели добавляют/убирают колонки.

### Операции

- **Фильтры**: Тип, Период, Статья, Контрагент, Сделка.
- **Кнопка «Добавить»**: форма с типом (income/expense/transfer), дата, сумма, счёт(а), статья, контрагент, сделка, повторять (создать PlanItem или Recurrence? → в MVP: повторяемость относится к плану, а факт — руками или через зарплатный генератор).

### Планирование (БДДС)

- **Таблица помесячно**; стрелки раскрытия по иерархии статей.
- **«Добавить план»**: форма PlanItem (тип, период, сумма, repeat, статья, счёт/источник/приёмник, контрагент/сделка/подразделение, описание).

### Отчёты ОДДС

- **Период**, фильтр по видам деятельности, тумблер «без округления».
- **Фиксированная первая колонка** (иерархия activity → type → статьи), колонки — месяцы.

## Текущий статус реализации

### ✅ Полностью реализовано

- **API**: Все основные endpoints работают
- **Demo System**: Полная система демо-данных
- **Reports API**: Все типы отчетов реализованы в backend (Dashboard, Cashflow/ОДДС, BDDS, Plan-Fact, DDS)
- **Worker App**: Автоматическая генерация зарплатных операций
- **Caching**: Redis кэширование для отчетов
- **Multi-tenancy**: Полная изоляция данных по companyId
- **Frontend**: Все основные страницы и функционал
- **Budget Management**: Полная система управления бюджетами с CRUD операциями
- **Plan Matrix Table**: Продвинутый компонент для отображения БДДС с группировкой по видам деятельности

### ⚠️ Частично реализовано

- **Dashboard Charts**: График на дашборде помечен как заглушка (требует библиотеку recharts)
- **Plan vs Fact в CashflowTable**: Плановые значения в отчете ОДДС вычисляются как заглушка (TODO комментарии в коде)
- **GeneratedSalaryOperation**: Тип определен в shared, но не используется в коде
- **Article Hierarchy**: Поле parentId есть в схеме, но иерархия не реализована в UI
- **Notifications System**: Базовая структура есть в shared, но функционал не реализован
- **Soft Delete**: Поля есть в схеме, но не используются в сервисах

### ❌ Не реализовано

- **Recurrence System**: Нет отдельной системы для шаблонов повторяющихся операций
- **User Management**: Нет расширенного управления пользователями (роли, права)
- **Import/Export**: Нет импорта банковских выписок или экспорта данных
- **Advanced Permissions**: Только базовая изоляция по companyId

## Границы MVP

### Ограничения

- Роли одинаковые внутри компании
- Только ОДДС + план-факт по БДДС; ОПиУ позже
- Без импорта банковских выписок (можно добавить как next step)
