# –§–ê–ó–ê 9: –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ

1. **–°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**
   - Ubuntu 24.04.2 LTS –æ–±–Ω–æ–≤–ª–µ–Ω
   - Docker v28.5.0 –∏ Docker Compose v2.40.0 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - UFW firewall –∞–∫—Ç–∏–≤–µ–Ω (–ø–æ—Ä—Ç—ã 22, 80, 443)
   - SSH –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏)

2. **–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `/opt/fin-u-ch/` —Å–æ–∑–¥–∞–Ω–∞
   - `.env` —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –ø–∞—Ä–æ–ª—è–º–∏
   - `docker-compose.yml` –∏ `nginx.conf` –∑–∞–≥—Ä—É–∂–µ–Ω—ã
   - GitHub username: `thoxly`
   - Docker –æ–±—Ä–∞–∑—ã: `ghcr.io/thoxly/fin-u-ch-*`

3. **CI/CD –æ–±–Ω–æ–≤–ª–µ–Ω:**
   - Workflow –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `GHCR_TOKEN`
   - –û–±—Ä–∞–∑—ã –±—É–¥—É—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å—Å—è –≤ `ghcr.io/thoxly/fin-u-ch-*`

## üìã –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ GHCR –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ GitHub Actions (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø) üöÄ**

1. –î–æ–±–∞–≤–∏—Ç—å SSH –∫–ª—é—á –≤ GitHub Secrets:

   ```bash
   cat ~/.ssh/id_rsa_server
   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –≤—ã–≤–æ–¥
   ```

2. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç:
   - –û—Ç–∫—Ä—ã—Ç—å: https://github.com/thoxly/fin-u-ch/settings/secrets/actions
   - New repository secret
   - Name: `VPS_SSH_KEY`
   - Value: –≤—Å—Ç–∞–≤–∏—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª—é—á
   - Add secret

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å workflow:
   - –û—Ç–∫—Ä—ã—Ç—å: https://github.com/thoxly/fin-u-ch/actions
   - –í—ã–±—Ä–∞—Ç—å "CI/CD with AI Review"
   - Run workflow ‚Üí main
   - ‚úÖ GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç GHCR –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!

**–°–ø–æ—Å–æ–± 2: –õ–æ–∫–∞–ª—å–Ω–æ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)**

```bash
ssh -i ~/.ssh/id_rsa_server root@83.166.244.139 "echo YOUR_GHCR_TOKEN | docker login ghcr.io -u thoxly --password-stdin"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```
Login Succeeded
```

üìù –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: `SETUP_VPS_SSH_KEY.md`

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å DNS –¥–ª—è –¥–æ–º–µ–Ω–∞ (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤)

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–º–µ–Ω–Ω–æ–≥–æ –∏–º–µ–Ω–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ –ê-–∑–∞–ø–∏—Å—å:

   ```
   –¢–∏–ø: A
   –ò–º—è: @ (–∏–ª–∏ –ø–æ–¥–¥–æ–º–µ–Ω)
   –ó–Ω–∞—á–µ–Ω–∏–µ: 83.166.244.139
   TTL: 300
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã:

   ```bash
   ssh -i ~/.ssh/id_rsa_server root@83.166.244.139

   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å certbot
   apt install certbot

   # –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (–∑–∞–º–µ–Ω–∏—Ç–µ yourdomain.com)
   certbot certonly --standalone -d yourdomain.com

   # –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
   mkdir -p /opt/fin-u-ch/ops/nginx/ssl
   cp /etc/letsencrypt/live/yourdomain.com/fullchain.pem /opt/fin-u-ch/ops/nginx/ssl/
   cp /etc/letsencrypt/live/yourdomain.com/privkey.pem /opt/fin-u-ch/ops/nginx/ssl/
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx (–±—É–¥–µ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –ø–æ—Å–ª–µ –¥–æ–º–µ–Ω–∞)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–∞ 1, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
ssh -i ~/.ssh/id_rsa_server root@83.166.244.139
cd /opt/fin-u-ch

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏–Ω–∞ –∫ GHCR
docker pull ghcr.io/thoxly/fin-u-ch-api:latest || echo "–û–±—Ä–∞–∑—ã –µ—â–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (–Ω–æ—Ä–º–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ –±—ã–ª–æ –¥–µ–ø–ª–æ—è)"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cat .env | grep DOCKER_IMAGE_PREFIX
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: DOCKER_IMAGE_PREFIX=thoxly/fin-u-ch
```

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –§–ê–ó–ï 10 (–ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π)

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —à–∞–≥–æ–≤ –≤—ã—à–µ:

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å: 85% ‚Üí 95%**

–û—Å—Ç–∞–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ:

1. –°–æ–±—Ä–∞—Ç—å Docker –æ–±—Ä–∞–∑—ã –ª–æ–∫–∞–ª—å–Ω–æ
2. Push –æ–±—Ä–∞–∑–æ–≤ –≤ GHCR
3. Pull –∏ –∑–∞–ø—É—Å–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
5. Health checks

## ‚ùì –í–æ–ø—Ä–æ—Å—ã

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/opt/fin-u-ch/.env` - –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã —Ç–∞–º
2. –õ–æ–≥–∏ Docker: `docker compose logs -f`
3. –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤: `docker compose ps`

## üìù –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GHCR –¥–æ—Å—Ç—É–ø–∞, –º–æ–∂–Ω–æ –±—É–¥–µ—Ç:

1. –ö–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ main
2. CI/CD –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑—ã
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ VPS (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
4. –ò–ª–∏ —Ä—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ –§–ê–ó–£ 10
